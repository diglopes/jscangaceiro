(function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a['default']}:function(){return a};return b.d(c,'a',c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p='',b(b.s=11)})([function(a,b,c){'use strict';var d=c(4);c.d(b,'a',function(){return d.a}),c.d(b,'f',function(){return d.b});var e=c(13);c.d(b,'b',function(){return e.a});var f=c(6),g=c(14);c.d(b,'g',function(){return g.a});var h=c(15);c.d(b,'c',function(){return h.a});var i=c(16);c.d(b,'d',function(){return i.a});var j=c(17);c.d(b,'e',function(){return j.a});var k=c(8),l=c(5),m=c(18);c.d(b,'h',function(){return m.a})},function(a,b,c){'use strict';c.d(b,'a',function(){return e});var d=c(0);let e=class{constructor(a=d.h('date'),b=d.h('quantity'),c=d.h('value')){Object.assign(this,{_quantity:b,_value:c}),this._date=new Date(a.getTime()),Object.freeze(this)}get date(){return new Date(this._date.getTime())}get quantity(){return this._quantity}get value(){return this._value}get volume(){return this._quantity*this._value}equals(a){return JSON.stringify(this)===JSON.stringify(a)}}},function(a,b,c){'use strict';c.d(b,'a',function(){return d});let d=class{constructor(a){this._element=document.querySelector(a)}template(){throw new Error('Method template was not implemented yet.')}update(a){this._element.innerHTML=this.template(a)}}},function(a,b,c){'use strict';var d=c(1);c.d(b,'a',function(){return d.a});var e=c(7),f=c(19);c.d(b,'b',function(){return f.a});var g=c(20);c.d(b,'c',function(){return g.a})},function(a,b,c){'use strict';function d(a){return a instanceof f||Object.getPrototypeOf(a)instanceof f}c.d(b,'a',function(){return e}),b.b=function(a){return d(a)?a.message:(console.error(a),'N\xE3o foi possivel realizar a opera\xE7\xE3o.')};let e=class extends Error{constructor(a=''){super(a),this.name=this.constructor.name}};const f=e},function(a,b,c){'use strict';c.d(b,'a',function(){return d});let d=class a{static create(b,c,d){return new Proxy(b,{get(b,e){return a._isFunction(b[e])&&c.includes(e)?function(){b[e].apply(b,arguments),d(b)}:b[e]},set(a,b,e){const f=Reflect.set(a,b,e);return c.includes(b)&&d(a),f}})}static _isFunction(a){return typeof a==typeof Function}}},function(a,b,c){'use strict';c.d(b,'a',function(){return g});const d=['negotiations'];let e=null,f=null,g=class a{constructor(){throw new Error('N\xE3o \xE9 poss\xEDvel criar inst\xE2ncias desta classe.')}static getConnection(){return new Promise((b,c)=>{e&&b(e);const d=indexedDB.open('jscangaceiro',2);d.onupgradeneeded=({target:b})=>a._createStores(b.result),d.onsuccess=({target:a})=>{e=a.result,f=e.close,e.close=()=>{throw new Error('N\xE3o \xE9 permitido fechar a conex\xE3o diretamente!')},b(e)},d.onerror=({target:a})=>c(a.error)})}static _createStores(a){d.forEach((b)=>{a.objectStoreNames.contains(b)&&a.deleteObjectStore(b),a.createObjectStore(b,{autoIncrement:!0})})}static closeConnection(){f.apply(e)}}},function(a,b,c){'use strict';c.d(b,'a',function(){return e});var d=c(1);let e=class{constructor(a){this._connection=a,this._store='negotiations'}save(a){return new Promise((b,c)=>{const d=this._connection.transaction([this._store],'readwrite').objectStore(this._store).add(a);d.onsuccess=()=>b(!0),d.onerror=({target:a})=>{console.error(a.error),c('N\xE3o foi poss\xEDvel salvar a negocia\xE7\xE3o')}})}getAll(){return new Promise((a,b)=>{const c=[],e=this._connection.transaction([this._store],'readwrite').objectStore(this._store).openCursor();e.onsuccess=({target:b})=>{const e=b.result;if(e){const{_date:a,_quantity:b,_value:f}=e.value,g=new d.a(new Date(a),b,f);c.push(g),e.continue()}else a(c)},e.onerror=({target:a})=>b(a.error)})}deleteAll(){return new Promise((a,b)=>{const c=this._connection.transaction([this._store],'readwrite').objectStore(this._store).clear();c.onsuccess=()=>a(!0),c.onerror=({target:a})=>{console.error(a.error),b('N\xE3o foi possivel apagar as negocia\xE7\xF5es.')}})}}},function(a,b,c){'use strict';c.d(b,'a',function(){return d});let d=class{_handlerError(a){if(!a.ok)throw new Error(a.statusText);return a}get(a){return fetch(a).then((a)=>this._handlerError(a)).then((a)=>a.json())}}},function(a,b,c){'use strict';c.d(b,'a',function(){return e});var d=c(10);let e=class{constructor(){throw new Error('This class should not be instatiated.')}static toText(a){return`${a.getDate()}/${a.getMonth()+1}/${a.getFullYear()}`}static toDate(a){const b=/^\d{2}\/\d{2}\/\d{4}$/;if(!b.test(a))throw new d.a;return new Date(...a.split('/').reverse().map((a,b)=>a-b%2))}}},function(a,b,c){'use strict';c.d(b,'a',function(){return e});var d=c(4);let e=class extends d.a{constructor(){super('A data deve estar no formato dd/mm/aaaa')}}},function(a,b,c){'use strict';Object.defineProperty(b,'__esModule',{value:!0});var d=c(12),e=c(3);const f=new e.a(new Date(),1,200),g=new Headers;g.set('Content-type','Application/json');const h={method:'POST',headers:g,body:JSON.stringify(f)};fetch('/negociacoes',h).then(()=>console.log('Dado enviado com sucesso!'));new d.a},function(a,b,c){'use strict';function d(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(a){return void c(a)}return g.done?void a(h):Promise.resolve(h).then(function(a){d('next',a)},function(a){d('throw',a)})}return d('next')})}}function e(a,b,c,d,e){var f={};return Object.keys(d).forEach(function(a){f[a]=d[a]}),f.enumerable=!!f.enumerable,f.configurable=!!f.configurable,('value'in f||f.initializer)&&(f.writable=!0),f=c.slice().reverse().reduce(function(c,d){return d(a,b,c)||c},f),e&&void 0!==f.initializer&&(f.value=f.initializer?f.initializer.call(e):void 0,f.initializer=void 0),void 0===f.initializer&&(Object.defineProperty(a,b,f),f=null),f}c.d(b,'a',function(){return p});var f,g,h,i,j,k,l,m=c(3),n=c(21),o=c(0);let p=(f=o.d('#data','#quantidade','#valor'),g=o.c('submit','.form'),h=o.c('click','#botao-apaga'),i=o.c('click','#botao-importa'),j=o.e(),f(k=(l=class{constructor(a,b,c){Object.assign(this,{_dateInput:a,_quantityInput:b,_valueInput:c}),this._negotiations=new o.b(new m.c(),new n.e('#negotiations'),'add','removeAll'),this._message=new o.b(new n.c(),new n.d('#message-view'),'text'),this._service=new m.b,this._init()}_init(){var a=this;return d(function*(){try{const b=yield o.g(),c=yield b.getAll();c.forEach(function(b){return a._negotiations.add(b)})}catch(b){a._message.text=o.f(b)}})()}add(a){var b=this;return d(function*(){try{a.preventDefault();const c=b._createNegotiation(),d=yield o.g();yield d.save(c),b._negotiations.add(c),b._message.text='Negocia\xE7\xE3o adicionada com sucesso!',b._cleanForm()}catch(a){b._message.text=a instanceof n.b?o.f(a):'Um erro n\xE3o esperado aconteceu. Entre em contato com o suporte.'}})()}clear(){var a=this;return d(function*(){try{const b=yield o.g();yield b.deleteAll(),a._negotiations.removeAll(),a._message.text='Negocia\xE7\xF5es removidas!'}catch(b){a._message.text=o.f(b)}})()}importNegotiations(){var a=this;return d(function*(){try{const b=yield a._service.getPeriodNegotiations();b.filter(function(b){return!a._negotiations.toArray().some(function(a){return a.equals(b)})}).forEach(function(b){return a._negotiations.add(b)}),a._message.text='Negocia\xE7\xF5es importadas com sucesso!'}catch(b){a._message.text=o.f(b)}})()}_createNegotiation(){const a=n.a.toDate(this._dateInput.value);return new m.a(a,parseInt(this._quantityInput.value),parseFloat(this._valueInput.value))}_cleanForm(){this._dateInput.value='',this._quantityInput.value=1,this._valueInput.value=0,this._dateInput.focus()}},e(l.prototype,'add',[g],Object.getOwnPropertyDescriptor(l.prototype,'add'),l.prototype),e(l.prototype,'clear',[h],Object.getOwnPropertyDescriptor(l.prototype,'clear'),l.prototype),e(l.prototype,'importNegotiations',[i,j],Object.getOwnPropertyDescriptor(l.prototype,'importNegotiations'),l.prototype),l))||k)},function(a,b,c){'use strict';c.d(b,'a',function(){return e});var d=c(5);let e=class{constructor(a,b,...c){const e=d.a.create(a,c,(a)=>b.update(a));return b.update(a),e}}},function(a,b,c){'use strict';function d(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(a){return void c(a)}return g.done?void a(h):Promise.resolve(h).then(function(a){d('next',a)},function(a){d('throw',a)})}return d('next')})}}c.d(b,'a',function(){return g});var e=c(7),f=c(6);let g=(()=>{var a=d(function*(){try{const a=yield f.a.getConnection();return new e.a(a)}catch(a){throw a}});return function(){return a.apply(this,arguments)}})()},function(a,b,c){'use strict';b.a=function(a=d.h('event'),b=d.h('selector'),c=!0){return function(d,e,f){return Reflect.defineMetadata('bindEvent',{event:a,selector:b,prevent:c,propertyKey:e},Object.getPrototypeOf(d),e),f}};var d=c(0)},function(a,b){'use strict';function c(a,b){document.querySelector(b.selector).addEventListener(b.event,(c)=>{b.prevent&&c.preventDefault(),a[b.propertyKey](c)})}b.a=function(...a){const b=a.map((a)=>document.querySelector(a));return function(a){const d=a,e=function(){const a=new d(...b);Object.getOwnPropertyNames(d.prototype).forEach((b)=>{return Reflect.hasMetadata('bindEvent',a,b)&&c(a,Reflect.getMetadata('bindEvent',a,b)),e.prototype=d.prototype,e})};return e.prototype=d.prototype,e}}},function(a,b){'use strict';b.a=function(a=500){return function(b,c,d){const e=d.value;let f=0;return d.value=function(...b){event&&event.preventDefault(),clearTimeout(f),f=setTimeout(()=>e.apply(this,b),a)},d}}},function(a,b){'use strict';b.a=function(a){throw new Error(`${a} é um parâmetro obrigatório!`)}},function(a,b,c){'use strict';function d(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(a){return void c(a)}return g.done?void a(h):Promise.resolve(h).then(function(a){d('next',a)},function(a){d('throw',a)})}return d('next')})}}c.d(b,'a',function(){return h});var e=c(8),f=c(1),g=c(0);let h=class{constructor(){this._http=new e.a}getTheWeekNegotiations(){return this._http.get('negociacoes/semana').then((a)=>a.map(({data:a,quantidade:b,valor:c})=>new f.a(new Date(a),b,c)),()=>{throw new g.a('N\xE3o foi possivel obter as negocia\xE7\xF5es.')})}getLastWeekNegotiations(){return this._http.get('negociacoes/anterior').then((a)=>a.map(({data:a,quantidade:b,valor:c})=>new f.a(new Date(a),b,c)),()=>{throw new g.a('N\xE3o foi possivel obter as negocia\xE7\xF5es da semana anterior.')})}getOldestNegotiations(){return this._http.get('negociacoes/retrasada').then((a)=>a.map(({data:a,quantidade:b,valor:c})=>new f.a(new Date(a),b,c)),()=>{throw new g.a('N\xE3o foi possivel obter as negocia\xE7\xF5es da semana retrasada.')})}getPeriodNegotiations(){var a=this;return d(function*(){try{const b=yield Promise.all([a.getTheWeekNegotiations(),a.getLastWeekNegotiations(),a.getOldestNegotiations()]);return b.reduce(function(a,b){return a.concat(b)},[]).sort(function(c,a){return a.date.getTime()-c.date.getTime()})}catch(a){throw new g.a('N\xE3o foi possivel obter as negocia\xE7\xF5es do per\xEDodo.')}})()}}},function(a,b,c){'use strict';c.d(b,'a',function(){return d});let d=class{constructor(){this._negotiationsList=[],Object.freeze(this)}add(a){this._negotiationsList.push(a)}toArray(){return[].concat(this._negotiationsList)}removeAll(){this._negotiationsList.length=0}get totalVolume(){return this.toArray().reduce((a,b)=>a+b.volume,0)}}},function(a,b,c){'use strict';var d=c(22);c.d(b,'d',function(){return d.a});var e=c(23);c.d(b,'e',function(){return e.a});var f=c(2),g=c(24);c.d(b,'c',function(){return g.a});var h=c(9);c.d(b,'a',function(){return h.a});var i=c(10);c.d(b,'b',function(){return i.a})},function(a,b,c){'use strict';c.d(b,'a',function(){return e});var d=c(2);let e=class extends d.a{template(a){return a.text?`
    <p class="alert alert-info">${a.text}</p>
    `:'<p></p>'}}},function(a,b,c){'use strict';c.d(b,'a',function(){return f});var d=c(2),e=c(9);let f=class extends d.a{template(a){return`
        <table class="table table-hover table-bordered">
            <thead>
                <tr>
                <th>DATA</th>
                <th>QUANTIDADE</th>
                <th>VALOR</th>
                <th>VOLUME</th>
                </tr>
            </thead>

            <tbody>
                ${a.toArray().map((a)=>`
                    <tr>
                        <td>${e.a.toText(a.date)}</td>
                        <td>${a.quantity}</td>
                        <td>${a.value}</td>
                        <td>${a.volume}</td>
                    </tr>
                    `).join('')}
            </tbody>

            <tfoot>
                <tr>
                    <td colspan=3></td>
                    <td>${a.totalVolume}</td>
                </tr>
            </tfoot>
        </table>
        `}}},function(a,b,c){'use strict';c.d(b,'a',function(){return d});let d=class{constructor(a=''){this._text=a}get text(){return this._text}set text(a){this._text=a}}}]);